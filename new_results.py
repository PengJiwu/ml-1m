import numpy as np
import matplotlib.pyplot as plt

# 1st way
# refer to the plots made by plot_movielens1m


# 2nd way
# movielens1m data 
# collrank method on illidan server
# lambda = 5000, rank = 100
# iteration, training time (sec), objective function, pairwise error, ndcg@10
c_8t = [
[0, 0.014428, 123364107.138016, 0.354694, 0.809031],
[1, 60.461624, 77359918.950206, 0.193167, 0.903038],
[2, 120.841961, 73656500.799962, 0.174762, 0.914865],
[3, 181.101060, 68749735.008653, 0.178981, 0.912770],
[4, 242.174933, 53654710.997413, 0.173515, 0.916705],
[5, 302.735743, 52745531.212267, 0.172995, 0.916936],
[6, 363.577662, 52503140.076845, 0.172935, 0.916724],
[7, 423.900341, 52362254.075160, 0.173024, 0.916638],
[8, 482.868367, 52271316.621000, 0.173381, 0.916111]
]


w_1c = [
[0, 0.0, 1.3468152515987006e8, 0.35573380867498533, 0.8084607688803492],
[1, 29.921209238, 6.86505728209969e7, 0.20270350564468284, 0.9003934410275787],
[2, 79.88802341899999, 5.624741740865532e7, 0.17783719548425508, 0.9144840825571474],
[3, 133.04194067999998, 5.412720046811799e7, 0.17566844919786173, 0.9162553305129454],
[4, 185.37783568299997, 5.330338663252411e7, 0.17525252525252596, 0.9167555210869113],
[5, 237.59078947199998, 5.2891063678044766e7, 0.1751485442661924, 0.9166068219719118],
[6, 289.80214101, 5.264915230904442e7, 0.17522281639928797, 0.9161279391103597],
[7, 342.012948064, 5.249268709486846e7, 0.17500000000000118, 0.9164608713950222],
[8, 394.192445172, 5.2384746221778326e7, 0.17519310754604972, 0.9164207706456952],
[9, 446.202411744, 5.230643911327625e7, 0.1750000000000013, 0.916006684951134],
[10, 498.115967764, 5.224767777239783e7, 0.17520796197266886, 0.9157964703712207],
[11, 550.072301986, 5.220229868742232e7, 0.17520796197266905, 0.915674985151531]
]

c_8t = np.array(c_8t)
w_1c = np.array(w_1c)

fig, ax = plt.subplots()
ax.plot(w_1c[:,1], w_1c[:,4], 'r--', label='primal 1 core')
ax.plot(c_8t[:,1], c_8t[:,4], 'm', label='collrank 8 threads')
ax.set_title('MovieLens1m, 200 ratings/user, rank 100, lambda = 5000')
ax.set_xlabel('Time')
ax.set_ylabel('NDCG')
ax.axis([0, 400, 0.75, 0.95])
legend = ax.legend(loc='lower right', shadow=True)
frame = legend.get_frame()
frame.set_facecolor('0.90')
plt.show()



# 1st way of comparing 
# MovieLens10m
# N = 500
c_8t = [
[0, 0.172671, 423569874.286366, 0.387794, 0.270276],
[1, 167.900662, 256290099.517283, 0.214414, 0.593757],
[2, 327.668976, 220399227.488486, 0.188643, 0.662968],
[3, 485.433874, 205371520.993825, 0.193158, 0.646608],
[4, 640.242916, 201409673.742713, 0.192271, 0.652576]
]

c_16t = [
[0, 0.213952, 423761824.084731, 0.392867, 0.263802],
[1, 130.155366, 256338376.040589, 0.214339, 0.591689],
[2, 246.018970, 220608463.160852, 0.188776, 0.664461],
[3, 354.314824, 205339157.494754, 0.193189, 0.649041],
[4, 462.549541, 201345001.016930, 0.192145, 0.654196],
[5, 570.042976, 199961228.953119, 0.191420, 0.657252],
[6, 689.531097, 199233496.196080, 0.191336, 0.657176]
]

w_1c = [
[0, 0.0, 5.902166560936847e8, 0.3886464107151499, 0.2758558730643191],
[1, 91.183635123, 2.625504453018211e8, 0.2438340458412661, 0.5865134472392063],
[2, 236.51416766300002, 2.1644040346117353e8, 0.1955717705280547, 0.6466068907173471],
[3, 396.49755062, 2.0619807551015484e8, 0.1924529567094535, 0.6522400951782721],
[4, 558.40830641, 2.0248196065562502e8, 0.19131034391974414, 0.6559313127268721],
[5, 722.5928240630001, 2.0077125573132166e8, 0.1909964007186548, 0.6572331155665702]
]

w2_1c = [
[0, 0.0, 5.902166560935967e8, 0.3886464107151499, 0.2758558730643191],
[1, 39.210486939, 2.6255044530182084e8, 0.2438340458412661, 0.5865134472392063],
[2, 99.21149757399999, 2.1644040346117392e8, 0.1955717705280547, 0.6466068907173471],
[3, 157.93937963399998, 2.0619807551015493e8, 0.1924529567094535, 0.6522400951782721],
[4, 215.77287086399997, 2.024819606556246e8, 0.19131034391974414, 0.6559313127268721],
[5, 274.47675737799995, 2.0077125573132145e8, 0.1909964007186548, 0.6572331155665702],
[6, 333.3754120489999, 1.9982484003226712e8, 0.1909394969456311, 0.6568724957923184],
[7, 390.2397345879999, 1.9923409687049478e8, 0.19102379579032389, 0.6569162950535602],
[8, 447.63957663199994, 1.9883503811922944e8, 0.19109535510584366, 0.6566286306180434],
[9, 502.59800476099997, 1.98549246395797e8, 0.19122522793858035, 0.6563026944470798],
[10, 556.246338489, 1.983351058455485e8, 0.19126306211842772, 0.6565677504307905],
[11, 612.535610744, 1.9816913961160746e8, 0.19129656523145205, 0.6566405632565935],
[12, 666.572150443, 1.9803696139308485e8, 0.1913304139786772, 0.6559917665225586],
[13, 720.526850187, 1.9792959475749466e8, 0.1914052283388594, 0.6566415470985729],
[14, 774.186568618, 1.978408828958352e8, 0.19147235340933172, 0.6569668041939772]
]

w_4c = [
[0, 0.0, 5.902166560936844e8, 0.38864641071515, 0.275855873064318],
[1, 37.415012206, 2.6255044530182096e8, 0.2438340458412662, 0.5865134472392064],
[2, 101.855683321, 2.1644040346117398e8, 0.19557177052805447, 0.6466068907173493],
[3, 167.54917495, 2.0619807550356698e8, 0.19245295670945337, 0.6522400951782722],
[4, 231.747492394, 2.0248196065424937e8, 0.19131034364032, 0.6559313127268719],
[5, 294.199105403, 2.0077125572907144e8, 0.19099640073068272, 0.6572331155665718],
[6, 359.843757267, 1.99824933187959e8, 0.19094516939076153, 0.6568178383050457]
]

w_8c = [
[0, 0.0, 5.902166560936844e8, 0.38864641071514966, 0.2758558730643181],
[1, 35.490865595, 2.6255044530182102e8, 0.24383404584126603, 0.5865134472392066],
[2, 81.750248056, 2.1644040346117392e8, 0.19557177052805444, 0.6466068907173494],
[3, 137.155899734, 2.0619807551015505e8, 0.19245295670945337, 0.652240095178272],
[4, 184.436720912, 2.0248211321822715e8, 0.19130915977747753, 0.6559228449905797],
[5, 231.585666289, 2.0077123742057288e8, 0.1909980421336187, 0.6572606623066698],
[6, 281.563712442, 1.998248252531421e8, 0.1909407729729401, 0.6568839252783671],
[7, 341.377647451, 1.9923408856211737e8, 0.19102117354962617, 0.6568625517480622],
[8, 408.517281573, 1.9883503435341763e8, 0.1910947792594329, 0.6565783016273545],
[9, 477.166769789, 1.9854924494024134e8, 0.1912255372056071, 0.6562982357840318],
[10, 547.432604799, 1.9833510551575786e8, 0.1912595091825495, 0.6565649558351667],
[11, 601.6147567620001, 1.9816914005815253e8, 0.19129546917757903, 0.6566854142315832],
[12, 655.3005364620001, 1.980369624405972e8, 0.19133244950093278, 0.655953020479399],
[13, 711.13814248, 1.9792959653923962e8, 0.19140857103350592, 0.6566274240331057],
[14, 767.166716726, 1.978408854325377e8, 0.19147577223667211, 0.6569914819296959],
[15, 821.531523116, 1.977665132549425e8, 0.1915554824556167, 0.6567639057983353],
[16, 876.4433338480001, 1.9770331657194605e8, 0.19161879504800647, 0.6565174239370359],
[17, 934.2970079950001, 1.976490897884403e8, 0.1916407771819463, 0.6559261843951616]
]

c_8t = np.array(c_8t)
c_16t = np.array(c_16t)
w_1c = np.array(w_1c)
w2_1c = np.array(w2_1c)
w_4c = np.array(w_4c)

fig, ax = plt.subplots()
ax.plot(w_1c[:,1], w_1c[:,4], 'r--', label='primal 1 core')
ax.plot(w2_1c[:,1], w2_1c[:,4], 'b', label='primal++ 1 core')
#ax.plot(w_4c[:,1], w_4c[:,4], 'k-.', label='primal 4 cores')
ax.plot(c_8t[:,1], c_8t[:,4], 'm', label='collrank 8 threads')
ax.plot(c_16t[:,1], c_16t[:,4], 'm--', label='collrank 16 threads')
ax.set_title('MovieLens10m, 500 ratings/user, rank 100, lambda = 7000')
ax.set_xlabel('Time')
ax.set_ylabel('NDCG')
ax.axis([0, 300, 0.25, 0.75])
legend = ax.legend(loc='lower right', shadow=True)
frame = legend.get_frame()
frame.set_facecolor('0.90')
plt.show()

# 2nd way of comparing 
# MovieLens10m
# program stops by itself because the objective function increases 
c_8t = [
[0, 0.430384, 1714540760.655697, 0.377320, 0.728866],
[1, 954.297133, 969089605.964054, 0.206414, 0.854384],
[2, 1652.631322, 1014368127.798295, 0.194925, 0.864967]
]

w2_1c = [
[0, 0.0, 1.9284766131014643e9, 0.37744576729870183, 0.7291483709059252],
[1, 184.725711105, 1.0016869049633231e9, 0.2157082457915117, 0.8476006625685936],
[2, 394.38232162199995, 8.176400232454574e8, 0.18750983494583512, 0.8710427756818643],
[3, 583.03430712, 7.602201716873997e8, 0.1837193819763299, 0.8744992987514464],
[4, 772.306077728, 7.363667578749316e8, 0.18196249319119429, 0.8760723032269473],
[5, 985.124755433, 7.252676380524333e8, 0.18090593901036944, 0.8765032613395886],
[6, 1200.543256722, 7.191398355479782e8, 0.18019695829983226, 0.8770959799171596],
[7, 1451.996451174, 7.152768381935598e8, 0.18002749461780174, 0.8772612868263139],
[8, 1696.8459665159999, 7.12657221899529e8, 0.17992547056433394, 0.8774654277136924],
[9, 1898.9814278009999, 7.107443866487083e8, 0.17956925098781942, 0.8777127769810475]
]

c_8t = np.array(c_8t)
#c_16t = np.array(c_16t)
#w_1c = np.array(w_1c)
w2_1c = np.array(w2_1c)
#w_4c = np.array(w_4c)

fig, ax = plt.subplots()
#ax.plot(w_1c[:,1], w_1c[:,4], 'r--', label='primal 1 core')
ax.plot(w2_1c[:,1], w2_1c[:,4], 'b', label='primal++ 1 core')
#ax.plot(w_4c[:,1], w_4c[:,4], 'k-.', label='primal 4 cores')
ax.plot(c_8t[:,1], c_8t[:,4], 'm', label='collrank 8 threads')
#ax.plot(c_16t[:,1], c_16t[:,4], 'm--', label='collrank 16 threads')
ax.set_title('MovieLens10m, 500 ratings/user, rank 100, lambda = 7000')
ax.set_xlabel('Time')
ax.set_ylabel('NDCG')
ax.axis([0, 1600, 0.6, 0.95])
legend = ax.legend(loc='lower right', shadow=True)
frame = legend.get_frame()
frame.set_facecolor('0.90')
plt.show()

# first way N = 500
# liweiwu@illidan:~/ml-1m$ python num2comp.py netflix -o netflix3 -n 500
# Dataset for 2649430 users, 17771 items loaded.
# Dataset sorted.
# Comparisons generated for 52316 users 17771 items

w2_1c = [
[0, 0.0, 4.872992791726362e9, 0.3396816043925223, 0.4714596463885728],
[1, 592.739507687, 3.958000357310691e9, 0.22629188826200344, 0.7350880361885725],
[2, 1323.8198562950001, 2.95751113047774e9, 0.17474011361114627, 0.8015130219144591],
[3, 2057.485106726, 2.614979921428081e9, 0.17003979083938156, 0.8041944226454084]
]




#author's code
#liweiwu@illidan:~/collrank$ ./collrank
#Loading training set file : data/netflix3_train.dat
#Segmentation fault (core dumped)







# 2nd way 
# liweiwu@illidan:~/ml-1m$ python num2comp2.py netflix -o netflix2 -n 200
#Dataset for 2649430 users, 17771 items loaded.
#Dataset sorted.
#Comparisons generated for 143205 users 17771 items


w_4c = [
[0, 0.0, 2.1446409182287426e10, 0.33905070043331914, 0.8237449246840507],
[1, 1950.880296768, 1.5296445553689487e10, 0.20282019948092284, 0.9008832154116739],
[2, 4274.372690166, 1.2360728866426361e10, 0.16541508094455779, 0.9239429043008047],
[3, 6863.185477328, 1.1201060890168451e10, 0.15907483056534277, 0.927832796599533],
[4, 9610.205437569, 1.0506708590904093e10, 0.1575356229802579, 0.9287461379815012],
[5, 12459.820362999, 1.007852678941796e10, 0.15718352478381095, 0.928807665773291],
[6, 15503.158421633001, 9.814149607013815e9, 0.15694113721975128, 0.9286800764159288],
[7, 18646.619253897003, 9.65471209287189e9, 0.15670045661036852, 0.9287440200152592],
[8, 21762.893460461004, 9.559636197870396e9, 0.15631654698586037, 0.9289188534279103],
[9, 24908.541142409005, 9.500454172201338e9, 0.15581997835270386, 0.9291884726197751]
]

w2_1c = [
[0, 0.0, 2.1446409182275578e10, 0.3390507004335007, 0.8237449246840567],
[1, 1770.616583331, 1.5296250478625748e10, 0.20282019948095564, 0.9008832154116733],
[2, 3699.73250579, 1.2360533791362661e10, 0.1654150809445686, 0.9239429043008105],
[3, 5701.03369706, 1.1200865815104984e10, 0.15907483056534968, 0.9278327965995501],
[4, 7751.477544747, 1.0506513515840456e10, 0.1575356229802614, 0.9287461379815054],
[5, 9855.117475828, 1.0078331714354235e10, 0.15718352478381345, 0.9288076657732963],
[6, 12069.897596648, 9.813954531950096e9, 0.15694113721975425, 0.9286800764159372],
[7, 14387.015918493, 9.654517017808353e9, 0.1567004566103711, 0.928744020015267],
[8, 16873.370589681, 9.559441122806704e9, 0.1563165469858606, 0.9289188534279086],
[9, 19442.07475399, 9.50025909713764e9, 0.15581997835270547, 0.9291884726197712],
[10, 21893.936444032, 9.463454428663479e9, 0.15549208787712557, 0.9293042969250987],
[11, 24451.883837078, 9.440025641402925e9, 0.15529252935767654, 0.9294490741807767],
[12, 26852.266197511, 9.424216031769766e9, 0.15508753961880078, 0.9295660794118714]
]
# author's code break
# Loading training set file : data/netflix2_train.dat
# Segmentation fault (core dumped)



#w_1c = np.array(w_1c)
w2_1c = np.array(w2_1c)
w_4c = np.array(w_4c)

fig, ax = plt.subplots()
#ax.plot(w_1c[:,1], w_1c[:,4], 'r--', label='primal 1 core')
ax.plot(w2_1c[:,1], w2_1c[:,4], 'b', label='primal++ 1 core')
ax.plot(w_4c[:,1], w_4c[:,4], 'k-.', label='primal 4 cores')

ax.set_title('MovieLens10m, 500 ratings/user, rank 100, lambda = 7000')
ax.set_xlabel('Time')
ax.set_ylabel('NDCG')
ax.axis([0, 25000, 0.75, 0.95])
legend = ax.legend(loc='lower right', shadow=True)
frame = legend.get_frame()
frame.set_facecolor('0.90')
plt.show()

